<script>
import { mapState, mapGetters, mapActions } from "vuex";
import { ElLoading } from 'element-plus';
import { CurrenceEnum } from '@/config/config.js';


export default {
  data() {
    return {
      isFavorite: false, // Track if the heart is filled or not
    }
  },

  props: {
    product: {
      type: Object,
      default() {
        return {
          id: 1,
          image: "http://localhost:4000/VehicleImages\\ac745ceeddb24d8a99228ce04239fb7dLogo.png",
          meals: 234424,
          year: 2012,
          brandId: 1,
          brandName: "مرسيدس بنز",
          modelId: 5,
          modelName: "سي كلاس",
          price: 33000,
          currency: 74,
          ownerId: 0,
          ownerName: "Super Admin Diaa",
          statusId: 83,
          status: "succeeded",
          moreInfo: "فيراري 488 جي تي بي هي سيارة رياضية فائقة الأداء (سوبر كار) من إنتاج شركة فيراري الإيطالية، وتم الكشف عنها لأول مرة في عام 2015 كخلفية لطراز فيراري 458. تعتبر 488 جي تي بي مزيجا مثاليا من الأدالء العالي، التصمي الجذاب، والتفنيات الحديثة",
          slug: "1_سي_كلاس_مرسيدس_بنز",

          bestThreeCategories: ["مميزة 1", "مميزة 2", "مميزة 3"]
        };
      }
    }
  },
  mounted() {
    this.chickIsFavoritFunc();

  },
  components: {

  },

  emits: {

  },

  watch: {
    product: {
      immediate: true,
      handler() {
        this.chickIsFavoritFunc();
      }
    },
    getFavoriteVehiclesIdData: {
      handler() {
        this.chickIsFavoritFunc();
      }
    }
  },

  created() {
    // Call the function from the store directly when the component is created

  },

  computed: {
    ...mapGetters("Vehicles", ["getFavoriteVehiclesIdData"]),

  },

  methods: {
    ...mapActions("Vehicles", ["ToggleVehicleFavorite", "GetVehiclesFavoriteId", "GetVehiclesFavorite"]),

    chickIsFavoritFunc() {
      // this.isFavorite = this.getFavoriteVehiclesIdData.includes(this.product.id);
    },

    async toggleFavoriteFunc() {
      const loading = ElLoading.service({
        lock: true,
        background: 'rgba(0, 0, 0, 0.7)',
        text: '',
      });

      try {
        const response = await this.ToggleVehicleFavorite(this.product.id);
        this.$moshaToast(response.message, {
          type: 'danger',
          timeout: 3000,
          showIcon: true,
        });

        await this.GetVehiclesFavoriteId(); // wait for fresh data
        await this.GetVehiclesFavorite(); // wait for fresh data
        this.chickIsFavoritFunc(); // re-evaluate
      } catch (error) {
        this.$moshaToast(error.response?.data?.message || 'حدث خطأ', {
          type: 'warning',
          timeout: 3000,
          showIcon: true,
        });
      } finally {
        loading.close();
      }
    },

    toProductFunc() {
      this.$router.push({ name: "vehicle", params: { slug: this.product.slug } });
    },

    toSellerGallaryFunc() {
      this.$router.push({ name: "gallary", params: { slug: this.product.ownerSlug } });
    },

    stripHtml(html) {
      const div = document.createElement('div');
      div.innerHTML = html;
      const text = div.textContent || div.innerText || '';
      return text.length > 20 ? text.slice(0, 75) + '...' : text;
    },

    formatCurrency(value, currency) {
      let currencyCode = "";

      switch (currency) {
        case CurrenceEnum.NIS:
          currencyCode = "ILS";
          break;
        case CurrenceEnum.JOD:
          currencyCode = "JOD";
          break;
        default:
          currencyCode = "USD";
      }

      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: currencyCode,
        minimumFractionDigits: 0, // No decimals
        maximumFractionDigits: 0  // No decimals
      }).format(value);
    },

  }
};
</script>
<template>
  <div class="gray-inp px-4 py-3 mt-3 mb-3 fav-card">
    <div class="row">
      <div class="col-12 col-lg-2 px-0">
        <a href="javascript:void(0)">
          <div class="image">
            <img class="img-fluid" v-on:click="toProductFunc()" :src="product.image" alt="">
          </div>
        </a>

      </div>
      <div class="col-12 col-lg-10 ">
        <div class="d-flex justify-content-between align-items-center mt-2 mt-lg-0">

          <div class="d-flex justify-content-start  ">
            <a href="details-product.html">
              <span class="title-name"> {{ product.name }}</span>
            </a>
          </div>

          <div class="d-flex justify-content-end text-end">
            <div class="gray_text">
              <!-- <span> Monday ، 16 April </span> -->
            </div>
            <a v-on:click="toggleFavoriteFunc()" href="javascript:void(0)" class="justify-content-end">
              <!-- <img src="/img/icons/star2.svg"> -->
              <svg viewBox="0 0 24 24" width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="SVGRepo_iconCarrier">
                  <path
                    d="M9.15316 5.40838C10.4198 3.13613 11.0531 2 12 2C12.9469 2 13.5802 3.13612 14.8468 5.40837L15.1745 5.99623C15.5345 6.64193 15.7144 6.96479 15.9951 7.17781C16.2757 7.39083 16.6251 7.4699 17.3241 7.62805L17.9605 7.77203C20.4201 8.32856 21.65 8.60682 21.9426 9.54773C22.2352 10.4886 21.3968 11.4691 19.7199 13.4299L19.2861 13.9372C18.8096 14.4944 18.5713 14.773 18.4641 15.1177C18.357 15.4624 18.393 15.8341 18.465 16.5776L18.5306 17.2544C18.7841 19.8706 18.9109 21.1787 18.1449 21.7602C17.3788 22.3417 16.2273 21.8115 13.9243 20.7512L13.3285 20.4768C12.6741 20.1755 12.3469 20.0248 12 20.0248C11.6531 20.0248 11.3259 20.1755 10.6715 20.4768L10.0757 20.7512C7.77268 21.8115 6.62118 22.3417 5.85515 21.7602C5.08912 21.1787 5.21588 19.8706 5.4694 17.2544L5.53498 16.5776C5.60703 15.8341 5.64305 15.4624 5.53586 15.1177C5.42868 14.773 5.19043 14.4944 4.71392 13.9372L4.2801 13.4299C2.60325 11.4691 1.76482 10.4886 2.05742 9.54773C2.35002 8.60682 3.57986 8.32856 6.03954 7.77203L6.67589 7.62805C7.37485 7.4699 7.72433 7.39083 8.00494 7.17781C8.28555 6.96479 8.46553 6.64194 8.82547 5.99623L9.15316 5.40838Z"
                    :stroke="isFavorite ? '#FFD700' : '#a09c9c'" :fill="isFavorite ? '#FFD700' : 'none'"
                    stroke-width="1.5" />
                </g>
              </svg>
            </a>

          </div>

        </div>

        <div class="d-flex justify-content-between align-items-center mt-2 ">
          <div class="d-flex justify-content-start align-items-center ">
            <span class="description-text-gray ms-1">{{ stripHtml(product.moreInfo) }}</span>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-2 ">

          <div class="col-8  col-md-5 col-lg-4 a3">
            <div class="d-flex justify-content-between align-items-center gab-3 gap-lg-5 ">
              <div class="d-flex align-items-center">
                <svg version="1.1" id="PRICE" width="24" height="24" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1800 1800"
                  enable-background="new 0 0 1800 1800" xml:space="preserve" fill="#26d829">
                  <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                  <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                  <g id="SVGRepo_iconCarrier">
                    <g id="Layer">
                      <g>
                        <g>
                          <g>
                            <g>
                              <path fill="#26d829"
                                d="M980.141,1426.945H799.02v-118.506c-69.393-6.158-141.632-26.024-190.641-53.104l-20.991-11.607 l52.338-204.102l35.001,19.166c33.877,18.551,103.21,49.678,186.896,49.678c43.264,0,86.914-13.717,86.914-44.368 c0-20.55-13.207-44.022-108.99-76.386C727.884,950.146,599.67,887.562,599.67,735.901c0-118.03,78.008-208.647,205.43-241.258 V373.055h181.121v108.638c76.854,6.214,127.293,26.167,159.665,41.397l23.395,11.01l-52.706,198.537l-34.932-16.757 c-30.332-14.56-81.1-38.932-160.461-38.932c-27.462,0-73.538,4.973-73.538,38.288c0,25.207,67.061,52.896,125.491,74.206 c156.457,54.756,223.372,131.853,223.372,257.641c0,62.643-21.977,119.475-63.568,164.353 c-37.588,40.571-90.052,69.527-152.798,84.567V1426.945z M861.015,1364.95h57.132v-120.313l25.729-4.437 c117.589-20.272,190.636-94.271,190.636-193.118c0-81.316-30.988-146.326-182.237-199.261 c-91.338-33.311-166.625-66.172-166.625-132.585c0-48.481,35.607-100.283,135.533-100.283 c68.248,0,119.197,15.615,154.484,30.171l20.221-76.148c-31.758-12.463-77.164-25.047-141.589-26.967l-30.071-0.899v-106.06 h-57.132v110.22L841.792,550c-112.789,21.082-180.128,90.579-180.128,185.901c0,88.71,59.123,146.45,197.689,193.064 c78.537,26.534,151.178,61.268,151.178,135.137c0,64.615-58.448,106.362-148.908,106.362 c-73.782,0-137.615-20.566-181.23-39.836l-20.731,80.85c39.862,17.4,101.68,34.715,171.28,36.791l30.072,0.9V1364.95z">
                              </path>
                            </g>
                          </g>
                          <g>
                            <g>
                              <path fill="none"
                                d="M1394.443,1646.797l13.552-28.16c-5.872,4.203-11.797,8.346-17.772,12.41L1394.443,1646.797z">
                              </path>
                            </g>
                            <g>
                              <path fill="#26d829"
                                d="M894.438,1721.617c-453.04,0-821.616-368.576-821.616-821.614c0-453.044,368.576-821.62,821.616-821.62 c453.043,0,821.627,368.576,821.627,821.62c0,144.397-37.492,280.184-103.18,398.222l61.597,16.502 c66.06-123.746,103.577-264.929,103.577-414.724c0-487.224-396.391-883.615-883.621-883.615 c-487.224,0-883.61,396.391-883.61,883.615c0,487.227,396.386,883.608,883.61,883.608 c154.789,0,300.383-40.053,427.035-110.271l-16.563-61.813C1184.061,1681.513,1043.848,1721.617,894.438,1721.617z">
                              </path>
                            </g>
                          </g>
                          <g>
                            <g>
                              <path fill="#26d829"
                                d="M1661.595,1783.611c-7.931,0-15.862-3.027-21.916-9.072l-150.333-150.333l-48.355,100.489 c-5.621,11.686-17.973,18.647-30.824,17.428c-12.904-1.211-23.697-10.326-27.053-22.842l-111.181-414.95 c-2.862-10.698,0.199-22.114,8.026-29.942c7.836-7.836,19.243-10.889,29.941-8.025l414.943,111.188 c12.514,3.355,21.63,14.149,22.841,27.054c1.202,12.903-5.743,25.202-17.427,30.824l-100.49,48.363l150.332,150.324 c5.813,5.813,9.073,13.699,9.073,21.916c0,8.225-3.261,16.104-9.073,21.925l-96.58,96.581 C1677.465,1780.584,1669.525,1783.611,1661.595,1783.611z M1480.368,1540.391c8.147,0,16.052,3.217,21.916,9.081 l159.311,159.311l52.749-52.749l-159.311-159.302c-7.101-7.108-10.326-17.211-8.641-27.122 c1.688-9.903,8.061-18.37,17.116-22.729l64.563-31.076l-282.357-75.659l75.651,282.356l31.066-64.555 c4.358-9.055,12.835-15.43,22.737-17.115C1476.9,1540.537,1478.639,1540.391,1480.368,1540.391z">
                              </path>
                            </g>
                          </g>
                        </g>
                        <path fill="#26d829"
                          d="M1140.299,292.544c111.231,0,327.736,121.636,327.736,344.61c0,17.12,13.873,30.997,30.997,30.997 c17.116,0,30.997-13.877,30.997-30.997c0-116.063-51.296-223.666-144.435-302.993c-73.896-62.941-170.182-103.612-245.296-103.612 c-17.116,0-30.998,13.877-30.998,30.998S1123.183,292.544,1140.299,292.544z">
                        </path>
                      </g>
                    </g>
                  </g>
                </svg>
                <span class="gray_text_2 ms-1">{{ formatCurrency(product.price, product.currency) }}</span>
              </div>
              <div class="d-flex align-items-center">
                <svg version="1.1" id="OFFER" width="24" height="24" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1800 1800"
                  enable-background="new 0 0 1800 1800" xml:space="preserve" fill="#26d829">
                  <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                  <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                  <g id="SVGRepo_iconCarrier">
                    <g>
                      <path fill="#26d829"
                        d="M1799.344,899.996c0-88.462-95.547-165.006-276.3-221.355c-16.881-5.265-34.349-10.276-52.301-15.054 c9.318-16.072,18.118-31.96,26.339-47.619c87.966-167.659,101.403-289.341,38.854-351.9c-25.566-25.557-61.558-38.52-106.981-38.52 c-75.811,0-177.951,37.532-292.485,103.924c-4.795-18.03-9.827-35.569-15.106-52.516C1065.015,96.198,988.466,0.657,900.001,0.657 c-88.462,0-165.011,95.541-221.36,276.299c-5.283,16.946-10.315,34.485-15.11,52.516 c-114.534-66.392-216.675-103.924-292.49-103.924c-45.424,0-81.41,12.958-106.972,38.52c-62.554,62.554-49.121,184.241,38.85,351.9 c8.216,15.659,17.021,31.547,26.334,47.619c-17.951,4.778-35.416,9.789-52.296,15.054C96.204,734.99,0.658,811.534,0.658,899.996 c0,88.469,95.546,165.01,276.299,221.366c16.88,5.262,34.345,10.268,52.296,15.055c-9.313,16.071-18.118,31.959-26.334,47.618 c-87.971,167.659-101.404,289.342-38.85,351.892c25.562,25.565,61.552,38.528,106.972,38.528 c75.815,0,177.957-37.536,292.49-103.924c4.799,18.022,9.827,35.561,15.11,52.512c56.349,180.753,132.893,276.3,221.36,276.3 c88.464,0,165.013-95.547,221.362-276.3c5.279-16.951,10.312-34.481,15.106-52.512c114.534,66.388,216.666,103.915,292.485,103.915 c45.424,0,81.415-12.963,106.973-38.52c62.558-62.55,49.12-184.232-38.846-351.892c-8.221-15.659-17.021-31.547-26.339-47.618 c17.952-4.787,35.42-9.793,52.301-15.055C1703.797,1065.006,1799.344,988.465,1799.344,899.996z M1481.194,1068.176 c-14.5,4.198-29.396,8.229-44.659,12.076c-9.125,2.301-18.355,4.549-27.736,6.718c-12.313,2.854-24.854,5.587-37.589,8.212 c7.123,10.83,14.043,21.605,20.719,32.303c5.12,8.194,10.073,16.345,14.912,24.45c8.046,13.455,15.686,26.77,22.949,39.935 c3.952,7.175,7.825,14.325,11.549,21.411c70.717,134.796,89.442,238.764,50.078,278.128c-13.322,13.331-34.34,20.085-62.462,20.085 c-60.529,0-143.164-29.456-237.269-81.607c-13.052-7.229-26.313-14.896-39.769-22.976c-8.071-4.848-16.213-9.854-24.415-14.991 c-10.662-6.692-21.438-13.622-32.302-20.806c-2.635,12.769-5.376,25.346-8.23,37.685c-2.15,9.301-4.382,18.444-6.666,27.499 c-3.864,15.343-7.912,30.317-12.128,44.896c-2.267,7.808-4.559,15.536-6.921,23.107 c-45.301,145.325-105.584,232.088-161.254,232.088c-55.673,0-115.957-86.763-161.256-232.088c-2.362-7.571-4.655-15.3-6.917-23.107 c-4.22-14.579-8.269-29.554-12.137-44.905c-2.279-9.046-4.506-18.189-6.661-27.49c-2.854-12.339-5.595-24.916-8.229-37.685 c-10.869,7.175-21.641,14.113-32.311,20.806c-8.199,5.137-16.336,10.144-24.407,14.991c-13.455,8.08-26.721,15.747-39.767,22.976 c-94.105,52.151-176.745,81.617-237.274,81.617c-28.118,0-49.13-6.764-62.453-20.087c-39.368-39.363-20.648-143.34,50.078-278.136 c3.715-7.086,7.593-14.236,11.549-21.411c7.254-13.165,14.904-26.479,22.94-39.935c4.843-8.105,9.797-16.256,14.912-24.45 c6.675-10.697,13.596-21.473,20.723-32.303c-12.735-2.625-25.276-5.357-37.59-8.212c-9.384-2.169-18.61-4.417-27.735-6.718 c-15.269-3.847-30.16-7.878-44.659-12.076c-7.808-2.267-15.537-4.559-23.111-6.921C150.37,1015.954,63.611,955.671,63.611,899.996 c0-55.673,86.758-115.952,232.084-161.257c7.575-2.362,15.304-4.655,23.111-6.916c14.504-4.203,29.39-8.225,44.659-12.076 c9.121-2.297,18.351-4.545,27.735-6.719c12.313-2.851,24.855-5.582,37.585-8.212c-7.127-10.833-14.043-21.601-20.719-32.297 c-5.115-8.199-10.069-16.345-14.917-24.451c-8.036-13.455-15.682-26.77-22.94-39.935c-3.952-7.18-7.834-14.329-11.549-21.412 c-70.722-134.795-89.446-238.772-50.074-278.144c13.323-13.323,34.335-20.077,62.453-20.077c60.529,0,143.165,29.457,237.27,81.612 c13.046,7.228,26.313,14.899,39.771,22.979c8.071,4.848,16.205,9.845,24.407,14.992c10.666,6.692,21.438,13.622,32.311,20.806 c2.635-12.769,5.375-25.346,8.229-37.694c2.155-9.297,4.382-18.443,6.661-27.485c3.869-15.352,7.913-30.326,12.137-44.905 c2.262-7.808,4.555-15.541,6.917-23.111C784.045,150.369,844.329,63.61,900.001,63.61c55.67,0,115.954,86.758,161.254,232.084 c2.362,7.57,4.654,15.308,6.921,23.115c4.225,14.579,8.264,29.545,12.138,44.897c2.274,9.046,4.506,18.197,6.656,27.493 c2.854,12.344,5.596,24.921,8.23,37.686c10.873-7.179,21.64-14.109,32.311-20.801c8.203-5.146,16.335-10.144,24.406-14.992 c13.455-8.08,26.727-15.751,39.769-22.979c94.104-52.151,176.739-81.612,237.269-81.612c28.122,0,49.14,6.758,62.462,20.086 c39.364,39.363,20.639,143.34-50.078,278.135c-3.724,7.079-7.597,14.228-11.549,21.408c-7.264,13.165-14.903,26.483-22.949,39.938 c-4.839,8.106-9.792,16.248-14.912,24.451c-6.676,10.693-13.587,21.465-20.719,32.297c12.735,2.63,25.276,5.362,37.589,8.212 c9.381,2.173,18.611,4.421,27.736,6.719c15.264,3.851,30.159,7.877,44.659,12.076c7.808,2.261,15.536,4.554,23.107,6.916 c145.325,45.305,232.088,105.584,232.088,161.257c0,55.675-86.763,115.958-232.088,161.259 C1496.73,1063.617,1489.002,1065.909,1481.194,1068.176z">
                      </path>
                      <path fill="#26d829"
                        d="M704.532,852.061c82.828,0,150.217-67.388,150.217-150.217c0-82.828-67.389-150.217-150.221-150.217 c-82.828,0-150.217,67.384-150.217,150.212C554.311,784.672,621.7,852.061,704.532,852.061z M704.528,614.58 c48.12,0,87.268,39.148,87.268,87.264s-39.148,87.264-87.264,87.264c-48.12,0-87.268-39.148-87.268-87.268 C617.264,653.725,656.413,614.58,704.528,614.58z">
                      </path>
                      <path fill="#26d829"
                        d="M1101.972,949.058c-82.837,0-150.226,67.389-150.226,150.227c0,82.828,67.389,150.207,150.226,150.207 c82.829,0,150.208-67.379,150.208-150.207C1252.18,1016.446,1184.801,949.058,1101.972,949.058z M1101.972,1186.538 c-48.119,0-87.271-39.144-87.271-87.254c0-48.129,39.152-87.273,87.271-87.273c48.11,0,87.255,39.145,87.255,87.273 C1189.227,1147.395,1150.082,1186.538,1101.972,1186.538z">
                      </path>
                      <path fill="#26d829"
                        d="M1198.448,561.357l-634.397,634.403c-12.291,12.295-12.291,32.223,0,44.519 c6.147,6.138,14.206,9.212,22.26,9.212c8.053,0,16.111-3.074,22.259-9.212l634.397-634.402c12.287-12.295,12.287-32.224,0-44.52 C1230.672,549.071,1210.744,549.071,1198.448,561.357z">
                      </path>
                    </g>
                  </g>
                </svg>
                <a href="javascript:void(0)" v-on:click="toSellerGallaryFunc()"><span
                    class="gray_text_2 ms-1 campany-name">
                    {{ product.ownerName }}</span></a>
              </div>
            </div>
          </div>


        </div>
      </div>
    </div>

  </div>
</template>
<style scoped>
.heart_svg {
  cursor: pointer;
  /* Change cursor to pointer for better UX */
}
</style>